# 保持与官方仓库同步并保留个人变更指南

## 概述
本指南将帮助您在fork的JeecgBoot项目中保持与官方仓库的同步，同时保留您在`my-custom`分支上的个人变更。

## 操作步骤表格

| 步骤 | 操作命令 | 说明 | 注意事项 |
|------|----------|------|----------|
| 1. 添加上游仓库 | `git remote add upstream https://github.com/jeecgboot/JeecgBoot.git` | 添加官方仓库作为上游源 | 只需执行一次 |
| 2. 查看远程仓库 | `git remote -v` | 确认origin和upstream都已配置 | origin指向您的fork，upstream指向官方 |
| 3. 切换到主分支 | `git checkout master` | 切换到本地主分支 | 确保在正确分支上操作 |
| 4. 拉取上游更新 | `git fetch upstream` | 获取官方仓库的最新更新 | 不会自动合并到本地 |
| 5. 合并上游更新 | `git merge upstream/master` | 将官方更新合并到本地master | 可能需要解决冲突 |
| 6. 推送到fork | `git push origin master` | 将更新推送到您的GitHub fork | 保持fork与官方同步 |
| 7. 切换到个人分支 | `git checkout my-custom` | 切换到您的个人开发分支 | - |
| 8. 变基到最新master | `git rebase master` | 将个人变更重新应用到最新代码上 | **推荐方式，保持历史清洁** |

## 替代方案：使用merge而非rebase

| 步骤 | 操作命令 | 说明 | 适用场景 |
|------|----------|------|----------|
| 7. 切换到个人分支 | `git checkout my-custom` | 切换到您的个人开发分支 | - |
| 8. 合并最新master | `git merge master` | 将最新master合并到个人分支 | 当rebase过于复杂时使用 |

## 冲突解决流程

| 情况 | 处理步骤 | 命令示例 | 说明 |
|------|----------|----------|------|
| rebase冲突 | 1. 编辑冲突文件<br>2. 标记已解决<br>3. 继续rebase | `git add <文件>`<br>`git rebase --continue` | 逐个解决冲突 |
| merge冲突 | 1. 编辑冲突文件<br>2. 提交合并 | `git add <文件>`<br>`git commit` | 一次性解决所有冲突 |
| 放弃操作 | 回到操作前状态 | `git rebase --abort`<br>或<br>`git merge --abort` | 当冲突过于复杂时 |

## 定期同步建议

| 频率 | 建议操作 | 目的 | 备注 |
|------|----------|------|------|
| 每周 | 执行步骤1-6 | 保持fork与官方同步 | 减少后续冲突 |
| 开发前 | 执行步骤7-8 | 确保在最新代码基础上开发 | 避免重复工作 |
| 发布前 | 完整执行所有步骤 | 确保包含最新官方修复 | 提高代码质量 |

## 最佳实践

| 实践 | 描述 | 好处 |
|------|------|------|
| 小而频繁的提交 | 将变更拆分为小的逻辑单元 | 减少冲突复杂度 |
| 描述性提交信息 | 清楚描述每次变更的目的 | 便于冲突解决时理解 |
| 定期备份 | 在重要操作前创建分支备份 | `git checkout -b my-custom-backup` |
| 测试验证 | 同步后进行完整测试 | 确保功能正常 |

## 紧急情况处理

| 问题 | 解决方案 | 命令 |
|------|----------|------|
| 误操作需要回滚 | 使用reflog查找并恢复 | `git reflog`<br>`git reset --hard <commit-hash>` |
| 个人分支损坏 | 从备份分支恢复 | `git checkout my-custom-backup`<br>`git checkout -b my-custom-new` |
| 无法解决冲突 | 寻求帮助或重新开始 | 联系团队或从clean state开始 |

## 注意事项

- ⚠️ 在执行rebase前，建议先创建备份分支
- ⚠️ 如果您的分支已经推送到远程，rebase后需要使用`git push --force-with-lease`
- ⚠️ 团队协作时，优先使用merge而非rebase
- ⚠️ 定期清理不需要的分支：`git branch -d <分支名>`

## 自动化脚本示例

```bash
#!/bin/bash
# sync-with-upstream.sh
echo "开始同步官方仓库..."
git checkout master
git fetch upstream
git merge upstream/master
git push origin master
echo "master分支已同步完成"

echo "更新个人分支..."
git checkout my-custom
git rebase master
echo "个人分支已更新完成"
```

使用方法：`chmod +x sync-with-upstream.sh && ./sync-with-upstream.sh`
